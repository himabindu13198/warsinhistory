# Results

Provide a short nontechnical summary of the most revealing findings of your analysis written for a nontechnical audience. Take extra care to clean up your graphs, ensuring that best practices for presentation are followed, as described in the audience ready style section below.


```{r, include=FALSE}
# mute all warnings and messgaes, and set codes not shown
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

# install and load the libraries
if(!require("ggplot2")) { install.packages("ggplot2"); library("ggplot2")}
if(!require("dplyr")) { install.packages("dplyr"); library("dplyr")}
if(!require("tidyverse")) { install.packages("tidyverse"); library("tidyverse")}
if(!require("maps")) { install.packages("maps"); library("maps")}
if(!require("GGally")) { install.packages("GGally"); library("GGally")}
if(!require("RColorBrewer")) { install.packages("RColorBrewer"); library("RColorBrewer")}
if(!require("parcoords")) { install.packages("parcoords"); library("parcoords")}
if(!require("gridExtra")) { install.packages("gridExtra"); library("gridExtra")}
if(!require("cowplot")) { install.packages("cowplot"); library("cowplot")}
if(!require("plotly")) { install.packages("plotly"); library("plotly")}
if(!require("vcd")) { install.packages("vcd"); library("vcd")}
if(!require("ggmosaic")) { install.packages("ggmosaic"); library("ggmosaic")}
if(!require("ggthemes")) { install.packages("ggthemes"); library("ggthemes")}
```


## War Types

In the first place, we are interested in **what types of wars happened most frequently** in that the original data sets are divided into 4 types: intra-state, inter-state, extra-state, and non-state wars. It is observed from *Figure 1* that there are most intra-state wars with number over 400, and then inter-state wars, extra-state wars with non-state wars are the least. Considering that the scale of inter-state wars is usually larger than scale of intra-state wars, the larger number of intra-state wars is expected and non-state wars are not very common with least occurences. In addition, according to *Figure 2* and definitions of wars types, we found that:  

* Within extra-state wars, there are two thrids of extra-state wars are imperial and one third of extra-state wars are colonial.
* All inter-state wars only have one type as inter-state.
* More than hald of the intra-state wars are civil wars for central control, while 40% are civil wars for local issues. In terms of the remaining intr-state wars, there are approximately twice intercommunal wars as regional internal wars.
* Among all non-state wars, the majority wars happened in non-state territories while little were cross state borders (actually there was one).

```{r fig.width=5}
# import data
inter_state <- read.csv('data/raw/Inter-StateWarData_v4.0.csv')
intra_state <- read.csv('data/raw/Intra-StateWarData_v4.1.csv')
extra_state <- read.csv('data/raw/Extra-StateWarData_v4.0.csv')
non_state <- read.csv('data/raw/Non-StateWarData_v4.0.csv')

# Intra state wars are further categorized into 3 types as follows
Civil_intra_state <- intra_state %>% filter(WarType==4 | WarType==5)
Regional_internal_intra_state <- intra_state %>% filter(WarType==6)
Intercommunal_intra_state <-intra_state %>% filter(WarType==7)

intra <- intra_state %>% 
  select(WarNum, WarName, WarType) %>% 
  mutate(Type="Intra-state") %>%
  mutate(SubType=ifelse(WarType==4, "4: Intra-Civil war for central control",
                        ifelse(WarType==5, "5: Intra-Civil war over local issues",
                               ifelse(WarType==6, "6: Intra-Regional internal","7: Intra-Intercommunal"))))

inter <- inter_state %>% 
  select(WarNum, WarName, WarType) %>% 
  mutate(Type="Inter-state") %>%
  mutate(SubType="1: Inter")

extra <- extra_state %>% 
  select(WarNum, WarName, WarType) %>% 
  mutate(Type="Extra-state") %>%
  mutate(SubType=ifelse(WarType==2, "2: Extra-Colonial", "3: Extra-Imperial"))

non <- non_state %>% 
  select(WarNum, WarName, WarType) %>% 
  mutate(Type="Non-state") %>%
  mutate(SubType=ifelse(WarType==8, "8: Non-In nonstate territory", "9: Non-Across state borders"))

total <- rbind(intra, inter, extra, non)
total$Type<- as.factor(total$Type)
total$SubType<- as.factor(total$SubType)

total_stacked <- total %>%
  group_by(Type, SubType) %>%
  summarise(count = n())
```



```{r}
# http://www.sthda.com/english/wiki/wiki.php?id_contents=7930#add-a-common-legend-for-multiple-ggplot2-graphs
get_legend<-function(myggplot){
  tmp <- ggplot_gtable(ggplot_build(myggplot))
  leg <- which(sapply(tmp$grobs, function(x) x$name) == "guide-box")
  legend <- tmp$grobs[[leg]]
  return(legend)
}

theme1 = theme(
  plot.title = element_text(hjust = 0.5, size=14),
  axis.text.y = element_text(size = 12),
  axis.text.x = element_text(size = 11),
  axis.title = element_text(size = 13),
  legend.text=element_text(size = 9.5),
  legend.title=element_text(size = 10.5))

p1<- ggplot(total_stacked, aes(y=count, x=Type, fill=SubType)) + 
  geom_bar(stat="identity") + 
  ggtitle("Figure 1: Stacked bar chart\nof war types") + 
  theme1 + 
  scale_y_continuous(limits=c(0,450)) + 
  scale_colour_colorblind() 

p2 <- ggplot(total_stacked, aes(y=count, x=Type, fill=SubType)) + 
  geom_bar(position="fill", stat="identity") + 
  ylab("percent") +
  ggtitle("Figure 2: Percent stacked bar chart\nof war types") + 
  theme(legend.position = "none") +
  theme1 + 
  scale_y_continuous(labels = scales::percent_format()) + 
  scale_colour_colorblind()

legend <- get_legend(p1)

p1 <- p1 + theme(legend.position="none")

lankPlot <- ggplot() + 
  geom_blank(aes(1,1)) + 
  cowplot::theme_nothing()
```



```{r fig.width=10.7, fig.height=6.5}
grid.arrange(p1, p2, legend,
             ncol=3, nrow = 1, 
             widths = c(2.5,2.5,1.5), 
             heights = c(4))
```


## Active States in Wars

```{r}
country_codes <- read.csv('data/raw/COW country codes.csv')
# Intra-state:
# if a war appears with two sides, then:
#   * if CcodeA is valid, add new row (WarNum, WarName, WarType, ccode=CcodeA) to data frame
#   * if CcodeB is valid, add new row (WarNum, WarName, WarType, ccode=CcodeB) to data frame

dfa2_intra_sidea <- intra_state %>% 
  select(WarNum, WarName, WarType, CcodeA, SideA, SideADeaths) %>%
  mutate(Type = "Intra-state", BatDeath = SideADeaths) %>%
  filter(CcodeA != -8) %>%
  mutate(StateName = SideA) %>%
  select(-CcodeA, -SideA, -SideADeaths)

dfa2_intra_sideb <- intra_state %>% 
  select(WarNum, WarName, WarType, CcodeB, SideB, SideBDeaths) %>%
  mutate(Type = "Intra-state", BatDeath = SideBDeaths) %>%
  filter(CcodeB != -8) %>%
  mutate(StateName = SideB) %>%
  select(-CcodeB, -SideB, -SideBDeaths)

dfa2_intra <- rbind(dfa2_intra_sidea, dfa2_intra_sideb)
dfa2_intra <- dfa2_intra[order(dfa2_intra$WarNum), ]

# Inter-state:
#  * if ccode is valid, add new row (WarNum, WarName, Type, ccode) to data frame
dfa2_inter <- inter_state %>%
  select(WarNum, WarName, WarType, StateName, BatDeath) %>%
  mutate(Type = "Inter-state")

# Extra-state:
#   * there are no war with both SideA and SideB existing, which means each row represents a war with one side record
#   * we can then safely add BatDeath and NonStateDeaths as total BatDeath
dfa2_extra_both_side <- extra_state %>% 
  select(WarNum, WarName, WarType, ccode1, SideA, ccode2, SideB, BatDeath) %>%
  filter(ccode1 != -8 & ccode2 != -8)

#nrow(dfa2_extra_both_side)

dfa2_extra_sidea <- extra_state %>% 
  select(WarNum, WarName, WarType, ccode1, SideA, BatDeath) %>%
  mutate(Type = "Extra-state")  %>%
  filter(ccode1 != -8) %>%
  mutate(StateName = SideA) %>%
  select(-ccode1, -SideA)

dfa2_extra_sideb <- extra_state %>% 
  select(WarNum, WarName, WarType, ccode2, SideB, BatDeath) %>%
  mutate(Type = "Extra-state")  %>%
  filter(ccode2 != -8) %>%
  mutate(StateName = SideB) %>%
  select(-ccode2, -SideB)

dfa2_extra <- rbind(dfa2_extra_sidea, dfa2_extra_sideb)

# Non-state: these wars are not about countries or states, and thus we don't take them into consideration. 
```


It is also interesting to explore what states participated most actively in the wars. Foe this question, we do not take non-state wars into consideration because non-state wars are not about state or countries.  


```{r fig.height=8, fig.width=6}
dfa2 <- rbind(dfa2_extra, dfa2_inter, dfa2_intra) %>%
  group_by(StateName) %>%
  summarise(Count = n())
# nrow(dfa2) 
# There are 160 countries in total

dfa2.1 <- dfa2[order(-dfa2$Count), ][1:100, ]

theme_dotplot <- theme_bw(15) + 
  theme(axis.text.x = element_text(size = rel(.75)),
        axis.text.y = element_text(size = rel(.5)),
        panel.grid.major.y = element_line(size = 0.5),
        panel.grid.minor.x = element_blank(),
        plot.title = element_text(hjust = 0.5, size = 14))


ggplot(dfa2.1, aes(x = Count, y = fct_reorder(StateName, Count))) +
  geom_point(color = "blue", size = 1) + 
  xlab("Number of Wars") +
  ylab("State Name") +
  ggtitle("Figure 3: Number of Wars for Each State") +
  scale_x_continuous(breaks = seq(0,100,5)) + 
  theme_dotplot 
```




```{r fig.height=8, fig.width=9}
dfa2.2 <- rbind(dfa2_extra, dfa2_inter, dfa2_intra) %>%
  group_by(StateName, Type) %>%
  summarise(Count = n())

ggplot(dfa2.2, aes(x = Count, y = fct_reorder2(StateName, Type=="Inter-state", Count, .desc = FALSE))) +
  geom_point(color = "blue", size = 1) + 
  xlab("Number of Wars") +
  ylab("State Name") +
  ggtitle("Figure 4: Number of Wars of State for Each War Type") +
  facet_wrap(Type~., scales = "free_y", ncol = 3) +
  scale_x_continuous(breaks = seq(0,60,5)) + 
  theme_dotplot 
```



